### Global Variables
@baseUrl = http://localhost:3000
@password = Password123!
# Note: Use the UUID from a previous signup response
@editorUuid = b848f9cc-720e-4e7f-b43d-d25d1ddb4f93

### 1. SETUP: Create a Target User (The potential Editor)
# @name signupEditor
POST {{baseUrl}}/auth/signup
Content-Type: application/json

{
    "name": "Archie Andrews",
    "email": "archie@riverdale.com",
    "password": "{{password}}"
}

### 3. LOGIN as Primary User (Jughead)
# @name loginPrimary
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "jughead@riverdale.com",
  "password": "{{password}}"
}

### CAPTURE ACCESS TOKEN
@authToken = {{loginPrimary.response.body.accessToken}}

### =============== CO-EDITOR TEST CASES ========================

### 4. CREATE a post WITH an initial editor array
# @name createWithEditors
POST {{baseUrl}}/posts
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "title": "Collaborative Burger Research",
  "description": "Jughead and Archie investigate the Pop's menu.",
  "isPublic": true,
  "editorUuids": ["{{editorUuid}}"]
}

@collabPostUuid = {{createWithEditors.response.body.uuid}}
@collabPostId = {{createWithEditors.response.body._id}}

### =============== PROFILE & PROGRESSIVE LOADING ========================

### 11. GET PROFILE OVERVIEW (Identity + Cached Stats)
# Used for the top glassmorphism section
# @name getOverview
GET {{baseUrl}}/me/overview
Authorization: Bearer {{authToken}}

### 12. GET SAVED INSIGHTS (Favorites)
# Used for the "My Favs" section
GET {{baseUrl}}/me/favorites?limit=4
Authorization: Bearer {{authToken}}

### 13. GET CONTRIBUTION GRID (Heatmap)
# Used for the GitHub-style activity grid
GET {{baseUrl}}/me/contribution-grid
Authorization: Bearer {{authToken}}

### =============== ANALYTICS & EVENTS ========================

### 14. RECORD A VIEW EVENT (Manual Test)
# Simulates a user landing on a post
POST {{baseUrl}}/analytics/event
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
    "postId": "{{collabPostId}}",
    "type": "view"
}

### =============== CASCADE DELETE TEST ========================

### 15. FAVORITE THE POST (Setup for Delete Test)
POST {{baseUrl}}/posts/{{collabPostUuid}}/favorite
Authorization: Bearer {{authToken}}

### 16. DELETE POST (Tests Side-Effect/Cascade on Favorites)
DELETE {{baseUrl}}/posts/{{collabPostUuid}}
Authorization: Bearer {{authToken}}

### 17. VERIFY FAVORITE IS GONE
GET {{baseUrl}}/me/favorites
Authorization: Bearer {{authToken}}