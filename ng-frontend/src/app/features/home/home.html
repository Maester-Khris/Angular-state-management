<div>
  <section class="hero-section position-relative overflow-hidden py-5 d-flex flex-column justify-content-center">
    <div class="container position-relative z-1 ">
      <div class="row align-items-center ">
        <div class="col-lg-6 mb-5 mb-lg-0 text-center text-lg-start">
          <div
            class="d-inline-flex align-items-center mb-4 py-2 px-3 rounded-pill glass-badge border border-primary-subtle shadow-sm">
            <span class="pulsing-dot me-2"></span>
            <span class="text-primary fw-bold small text-uppercase tracking-widest">
              Share ideas. Build presence.
            </span>
          </div>

          <h1 class="hero-title fw-black lh-1 mb-4">
            Where thoughtful posts<br>
            <span class="text-gradient-animated">become influence</span>
          </h1>

          <p class="hero-lead mb-5">
            Join the elite circle of <span class="text-dark fw-semibold">engineers, creators, and builders</span>.
            Publish high-fidelity content and curate the future of technical influence.
          </p>

          <div
            class="d-flex flex-column flex-sm-row gap-4 align-items-sm-center justify-content-center justify-content-lg-start">
            <a routerLink="/dashboard/myactivity" class="btn btn-primary-elevated btn-lg px-5 py-3">
              Start Writing <i class="bi bi-arrow-right ms-2"></i>
            </a>
            <a (click)="scrollToCommunity()" class="link-secondary fw-semibold text-decoration-none hover-underline">
              Explore Community Posts
            </a>
          </div>

          <div
            class="mt-5 pt-4 border-top border-light d-flex align-items-center justify-content-center justify-content-lg-start gap-3">
            <div class="avatar-stack">
              <img src="https://i.pravatar.cc/40?u=1" alt="user" class="rounded-circle border border-2 border-white">
              <img src="https://i.pravatar.cc/40?u=2" alt="user"
                class="rounded-circle border border-2 border-white ms-n2">
              <img src="https://i.pravatar.cc/40?u=3" alt="user"
                class="rounded-circle border border-2 border-white ms-n2">
            </div>
            <span class="text-muted small fw-medium">Join <span class="text-dark fw-bold">1.2k+</span> authors shaping
              the web.</span>
          </div>
        </div>
        <div class="col-lg-6 position-relative d-none d-lg-block">
          <div class="hero-visual mx-auto">
            <div class="floating-card card shadow-lg">
              <div class="card-body">
                <span class="badge bg-secondary-subtle text-secondary mb-2">Engineering</span>
                <h6 class="fw-bold mb-1">Getting Started with Angular</h6>
                <p class="small text-muted mb-0">A clean architecture-first approach.</p>
              </div>
            </div>
            <div class="floating-card card shadow-lg delay-1">
              <div class="card-body">
                <span class="badge bg-success-subtle text-success mb-2">Design</span>
                <h6 class="fw-bold mb-1">Designing for Scale</h6>
                <p class="small text-muted mb-0">Why constraints create clarity.</p>
              </div>
            </div>
            <div class="floating-card card shadow-lg delay-2">
              <div class="card-body">
                <span class="badge bg-warning-subtle text-warning mb-2">Product</span>
                <h6 class="fw-bold mb-1">From MVP to Platform</h6>
                <p class="small text-muted mb-0">Lessons from real startups.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="gradient-blob blob-1"></div>
    <div class="gradient-blob blob-2"></div>
  </section>

  <div #communityGrid class="home-container px-3 px-md-4" *ngIf="vm$ | async as vm" style="margin-top: 40px!important;">
    <header class="home-header mb-5">
      <app-search-bar (search)="onSearch($event)"></app-search-bar>
    </header>

    <div class="home-content-layout d-flex flex-column flex-lg-row gap-4"
      [class.has-sidebar]="vm.proposedLinks && vm.proposedLinks.length > 0" *ngIf="vm.isAvailable">
      <div class="bento-grid-container flex-grow-1">
        <div class="bento-grid" id="community-post">
          @for (post of vm.posts; track post.uuid; let i = $index) {
          <div class="bento-item" (click)="openDetails(post.uuid!)" [attr.data-post-id]="post.uuid"
            [trackPreview]="post.uuid!">
            <app-post-card [post]="post" mode="card">
              <div actions>
                <button class="btn-fav ms-auto">
                  <i class="bi bi-bookmark-plus"></i>
                </button>
              </div>
            </app-post-card>
          </div>
          }
          @if (vm.loading) {
          @for (i of [1, 2, 3]; track i) {
          <div class="bento-item">
            <app-skeleton-card></app-skeleton-card>
          </div>
          }
          }
        </div>
      </div>

      <!-- Related Links Side Panel -->
      <aside class="related-links-panel h-llm-panel" *ngIf="vm.proposedLinks && vm.proposedLinks.length > 0">
        <div class="panel-header mb-4">
          <h5 class="fw-bold text-white d-flex align-items-center">
            <i class="bi bi-stars me-2 text-info"></i>AI Web Intelligence
          </h5>
          <p class="text-light-emphasis small">External resources curated by LLM RAG Retrieval</p>
        </div>

        <div class="links-scroll-container">
          <div class="links-list d-flex flex-column gap-3">
            <div class="link-item premium-glass-card p-3 rounded-4 border border-info-subtle shadow-sm"
              *ngFor="let link of (showAllLinks() ? vm.proposedLinks : vm.proposedLinks.slice(0, 3))">
              <a [href]="link.url" target="_blank" class="text-decoration-none">
                <div class="d-flex gap-3">
                  <div class="link-image-wrapper flex-shrink-0" *ngIf="link.imageUrl">
                    <img [src]="link.imageUrl" [alt]="link.title" class="rounded-3 object-fit-cover"
                      style="width: 70px; height: 70px;">
                  </div>
                  <div class="link-content">
                    <h6 class="fw-bold text-white mb-1 link-title-premium small">{{ link.title }}</h6>
                    <p class="text-light-emphasis smallest mb-0 line-clamp-2">{{ link.description }}</p>
                  </div>
                </div>
              </a>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-center mt-3" *ngIf="vm.proposedLinks.length > 3">
          <button (click)="toggleLinks()" class="btn btn-sm btn-link text-info text-decoration-none fw-bold smallest">
            {{ showAllLinks() ? 'Show Less' : 'Show ' + (vm.proposedLinks.length - 3) + ' More Links' }}
            <i class="bi" [class.bi-chevron-down]="!showAllLinks()" [class.bi-chevron-up]="showAllLinks()"></i>
          </button>
        </div>

        <div class="panel-footer mt-4 pt-3 border-top border-info-subtle">
          <div
            class="d-flex align-items-center justify-content-center gap-2 text-info-emphasis smallest fw-bold text-uppercase tracking-wider">
            <span class="pulsing-dot-green"></span>
            result proposed by groq LLM
          </div>
        </div>
      </aside>
    </div>

    <!-- API Unavailable or Empty State -->
    <div class="empty-state-container py-5 text-center"
      *ngIf="!vm.isAvailable || (vm.posts.length === 0 && !vm.loading)">
      <div class="empty-icon-wrapper mb-4">
        <i class="bi bi-cloud-slash text-muted display-1"></i>
      </div>
      <h3 class="fw-bold text-dark mb-3">{{ !vm.isAvailable ? 'Server Connection Lost' : 'No posts found' }}</h3>
      <p class="text-muted mx-auto" style="max-width: 400px;">
        {{ !vm.isAvailable ? 'We are having trouble reaching our servers. Please check your connection or try again
        later.' : 'No posts matched your criteria. Try adjusting your search or check back later.' }}
      </p>
      <button class="btn btn-outline-primary rounded-pill px-4 mt-3" (click)="ngOnInit()" *ngIf="!vm.isAvailable">
        <i class="bi bi-arrow-clockwise me-2"></i>Retry Connection
      </button>
    </div>

    <div class="status-footer py-5 text-center" *ngIf="vm.isAvailable">
      @if (vm.loading) {
      <app-loading-spinner size="sm" label="Fetching more insights..."></app-loading-spinner>
      }

      @if(vm.hasMore) {
      <div appInfiniteScroll (scrolled)="loadMore(vm.loading)" class="scroll-anchor"></div>
      } @else if (vm.posts.length > 0) {
      <div class="no-more-indicator">
        <hr class="w-25 mx-auto opacity-10">
        <p class="text-muted small fw-medium">No more posts at this time.</p>
      </div>
      }
    </div>

    <div class="immersive-overlay" [class.active]="isDrawerOpen()" (click)="closeDetails()">
      <div class="detail-container" (click)="$event.stopPropagation()">
        <router-outlet></router-outlet>
      </div>
    </div>

  </div>
</div>
<app-footer></app-footer>