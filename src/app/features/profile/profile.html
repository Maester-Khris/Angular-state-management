<div class="profile-dashboard-grid">
  <main class="center-content-wrapper">
    <!-- Profile -->
    @if(profile()){
    <section class="profile-card">
      <div class="profile-cover"></div>
      <div class="profile-content text-center d-flex flex-column justify-content-center">
        <div class="avatar-wrapper align-self-center">
          @if (profile()) {
          <img [src]="profile()!.avatar" class="profile-avatar shadow" alt="Avatar">
          <span class="status-indicator online animate-fade-in"></span>
          } @else {
          <div class="profile-avatar glass-loading"></div>
          }
        </div>
        <div class="mt-3">
          <h3 class="fw-bold mt-2 mb-1">{{ profile()?.name }}</h3>
          <p class="text-muted mb-2 small">{{ profile()?.bio }}</p>
          <div class="d-flex justify-content-center gap-2">
            <button class="btn btn-primary btn-sm px-4 rounded-pill">Edit Profile</button>
            <button class="btn btn-light btn-sm px-3 rounded-circle"><i class="bi bi-share"></i></button>
          </div>
        </div>
      </div>
    </section>
    }@else {
    <div class="profile-card glass-loading" style="height: 280px;"></div>
    }

    <!-- Drafts -->
    <section class="drafts-lab">
      @if (drafts().length > 0 ) {
      <h6 class="section-title mb-3">The Lab <span class="badge rounded-pill bg-light text-dark ms-2">2 Drafts</span>
      </h6>
      <div class="draft-card-container">
        @for (draft of drafts(); track draft.id) {
        <div class="draft-card">
          <div class="draft-status">DRAFT</div>
          <div class="draft-body">
            <h6 class="mb-1 ">{{draft.title}}</h6>
            <p class="smallest text-muted mb-0">Last edited {{ draft.lastModifiedAt | date:'shortTime' }}</p>
          </div>
          <i class="bi bi-arrow-right-short ms-auto"></i>
        </div>
        }
      </div>
      }@else {
      <div class="glass-loading" style="height: 150px;"></div>
      }
    </section>

    <section class="contribution-section">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h6 class="section-title mb-0">Contribution Activity</h6>
        <span class="badge rounded-pill bg-light text-dark ms-2">Last 12 Months</span>
      </div>

      <div class="card border-0 shadow-sm glass-morphism">
        <div class="card-body p-3">
          <div class="contribution-container">
            <div class="contribution-heatmap-grid">
              @for (level of contributionData(); track $index) {
              <div class="heatmap-cell" [class]="'level-' + level" [title]="'Contribution level: ' + level">
              </div>
              }
            </div>

            <div class="d-flex align-items-center justify-content-end gap-1 mt-2">
              <span class="smallest text-muted me-1">Less</span>
              <div class="heatmap-cell level-0"></div>
              <div class="heatmap-cell level-1"></div>
              <div class="heatmap-cell level-2"></div>
              <div class="heatmap-cell level-3"></div>
              <span class="smallest text-muted ms-1">More</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Right Sidebar -->
  <aside class="right-sidebar-wrapper">

    <div class=" mb-4">
      @if(profile()){
      <div class="stats-mini-grid animate-fade-in">
        @for (stat of [
        {label: 'Posts', value: profile()?.stats?.posts},
        {label: 'Reach', value: profile()?.stats?.reach + 'k'},
        {label: 'Co-Auth', value: profile()?.stats?.coauth},
        {label: 'Since', value: profile()?.stats?.since}
        ]; track stat.label) {
        <div class="stat-mini-card glass-morphism">
          <span class="stat-label">{{ stat.label }}</span>
          <span class="stat-value">{{ stat.value }}</span>
        </div>
        }
      </div>
      } @else {
      <div class="stats-mini-grid">
        @for (i of [1,2,3,4]; track $index) {
        <div class="stat-mini-card glass-loading border-0">
          <div class="skeleton-text-sm mb-2"></div>
          <div class="skeleton-text-lg"></div>
        </div>
        }
      </div>
      }
    </div>

    <div class="sidebar-section p-3 glass-morphism mb-4">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h6 class="section-title mb-0">Saved Insights</h6>
        <a href="#" class="text-primary smallest fw-bold text-decoration-none">
          View All <i class="bi bi-arrow-right ms-1"></i>
        </a>
      </div>

      @if (favs().length > 0) {
      <div class="favorites-grid animate-fade-in">
        @for (fav of favs(); track fav.id) {
        <div class="fav-card-pro">
          <div class="fav-icon-border"><i class="bi bi-journal-text"></i></div>
          <div class="fav-info">
            <div class="fav-title">
              {{ fav.title.length > 20 ? (fav.title | slice:0:20) + '...' : fav.title }}
            </div>
            <div class="fav-date">{{ fav.createdAt | date:'MMM d, y' }}</div>
          </div>
        </div>
        }
      </div>
      } @else {
      <div class="favorites-grid">
        @for (i of [1,2,3]; track $index) {
        <div class="fav-card-pro mb-2">
          <div class="fav-icon-border glass-loading border-0"></div>
          <div class="fav-info flex-grow-1">
            <div class="glass-loading mb-2" style="height: 12px; width: 80%;"></div>
            <div class="glass-loading" style="height: 8px; width: 40%;"></div>
          </div>
        </div>
        }
      </div>
      }
    </div>

    <!-- Account history -->
    <div class="sidebar-section card border-0 shadow-sm glass-morphism">
      <div class="card-body p-3">
        <h6 class="section-title mb-4">Recent Activity</h6>
        <div class="activity-timeline">

          @if (account_activity().length > 0) {
          @for (item of account_activity(); track item.id; let last = $last) {
          <div class="timeline-item" [class.border-0]="last">
            <div class="timeline-indicator">
              <div class="timeline-marker" [ngClass]="{
                'bg-light-primary': item.type === 'publish',
                'bg-light-success': item.type === 'join',
                'bg-light-warning': item.type === 'security'
              }">
                <i class="bi" [ngClass]="{
                  'bi-file-earmark-text text-primary': item.type === 'publish',
                  'bi-person-plus text-success': item.type === 'join',
                  'bi-shield-check text-warning': item.type === 'security'
                }"></i>
              </div>
              @if (!last) { <div class="timeline-connector"></div> }
            </div>

            <div class="timeline-content">
              <div class="d-flex justify-content-between align-items-start">
                <p class="mb-0 small text-dark">
                  @if (item.type === 'publish') { Published <strong>"{{item.target}}"</strong> }
                  @else if (item.type === 'join') { Joined <strong>{{item.target}}</strong> team }
                  @else { {{item.target}} }
                </p>
                <span class="smallest text-muted text-end">{{ item.time }}</span>
              </div>
              @if (item.meta) {
              <p class="smallest text-muted mt-1">{{ item.meta }}</p>
              }
            </div>
          </div>
          }
          } @else {
          @for (i of [1,2,3]; track $index) {
          <div class="timeline-item">
            <div class="timeline-indicator">
              <div class="timeline-marker glass-loading"></div>
              <div class="timeline-connector"></div>
            </div>
            <div class="timeline-content w-100">
              <div class="glass-loading mb-2" style="height: 12px; width: 80%;"></div>
              <div class="glass-loading" style="height: 8px; width: 40%;"></div>
            </div>
          </div>
          }
          }
        </div>
      </div>
    </div>
  </aside>
</div>